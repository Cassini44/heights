const w={swapColumnName(t,e,r){return t[0][t[0].indexOf(e)]=r,t},clone2DArray(t){return t.map(e=>[...e])},createLookupObjectFromTable(t,e,r){var a=t[0].indexOf(e),n=t[0].indexOf(r);return t.reduce((o,i,s)=>(s&&(o[i[a]]=i[n]),o),{})},copyToClipBoard(t){navigator.clipboard.writeText(t).then(()=>{console.log("Text copied to clipboard!")}).catch(e=>{console.error("Failed to copy text: ",e)})},addClassTo(t,e){w.q(t).map(r=>{r.classList.add(e)})},removeClassFromAll(t){w.q(`.${t}`).map(e=>{e.classList.remove(t)})},q(t){return[...document.querySelectorAll(t)]},$(t){return document.getElementById(t)},getClientRect(t){return j.$(t).getBoundingClientRect()},runOnPageLoad(t){window.addEventListener("load",t)},detectMobile(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(e=>navigator.userAgent.match(e))},cssVar(t,e){var r=document.documentElement,a=getComputedStyle(document.querySelector(":root")).getPropertyValue(t);e&&r.style.setProperty(t,e);var n=r.style.getPropertyValue(t);return console.log(`${a} ----> ${n}`),n||a},wrapInSpan(t,e){return`<span ${e||""}>${t}</span>`},debug_css:{listAllClasses(){const t=document.querySelectorAll("*"),e=new Set;return t.forEach(r=>{r.classList.forEach(a=>e.add(a))}),Array.from(e).sort()},traceParentHeights(t){let e=document.querySelector(t);for(;e;){const r=window.getComputedStyle(e),a=parseFloat(r.marginTop),n=parseFloat(r.marginBottom),o=parseFloat(r.paddingTop),i=parseFloat(r.paddingBottom),s=parseFloat(r.borderTopWidth),d=parseFloat(r.borderBottomWidth);console.log({tagName:e.tagName,id:e.id||"(no id)",className:e.className||"(no class)",offsetHeight:e.offsetHeight,computedHeight:r.height,margin:{top:a,bottom:n,total:a+n},padding:{top:o,bottom:i,total:o+i},border:{top:s,bottom:d,total:s+d},totalHeight:e.offsetHeight+a+n}),e=e.parentElement}}},printObject(t){console.log(JSON.stringify(t,null,2))},array:{isInList(t,e){return e.indexOf(t)>-1},clone2DArray(t){return t.map(e=>[...e])},forceTemplate3(t,c,r){var a=[],n=t[0],o;for(o in c)if(/=\[.*\]/.test(c[o])){var i=c[o].match(/(.*)=\[(.*)\]/),s=i[1],d=i[2],l=n.indexOf(s);t[0][l]=d,a.push(l)}else a.push(n.indexOf(c[o]));r&&n.map((m,f)=>{a.includes(f)||a.push(f)});var c=t.map(function(m,f){var b=[];for(o in a)b.push(m[a[o]]??(f===0?c[o]:""));return b});return c},arrayToObject(a,e){var r=e.shift(),a=r.indexOf(a);return e.reduce((n,o,i)=>{var s=o[a];return s&&(n[s]={},o.map((d,l)=>{l!==a&&(n[s][r[l]]=d)})),n},{})},pc(t,e,r,a){var n=[],o=typeof e=="string";o?e=t[0].indexOf(e):e=e;for(var i=t.length,s=0;s<i;s++)n.push(t[s][e]);return a||n.shift(),r&&(n=[...new Set(n)]),n},objectToArray(t,e){var r=new Set;Object.keys(t).map(o=>{var i=Object.keys(t[o]);i.map(s=>{r.add(s)})});var a=[...r],n=Object.keys(t).map((o,i)=>{var s=t[o],d=[o];return a.map(l=>{d.push(s[l]??"")}),d});return n.unshift([e,...a]),n},distinctRows(t,e){var r=new Set,a=e?e.map(n=>t[0].indexOf(n)):"";return t.filter(n=>{var o=a?a.reduce((i,s)=>(i+=n[s],i),""):n.join("");return r.has(o)?!1:(r.add(o),!0)})},leftJoin(t,e,r,a){e[0][e[0].indexOf(a)]=r;var n=a.toUpperCase();r=t[0].map(i=>i.toUpperCase()).indexOf(r.toUpperCase());var o=e[0].reduce((i,s,d)=>(d&&i.push(""),i),[]);return a=e[0].map(i=>i.toUpperCase()).indexOf(a.toUpperCase()),e=e.reduce((i,s,d)=>{var l=s[a];return i[l]=[...s].filter(c=>c!==s[a]),i},{}),t.map((i,s)=>{var d=s?e[i[r]]:e[n];return d?i.push(...d):i.push(...o),i})},arrayFormula(t,e,r,a){function n(d){var l=d[0],c=l.reduce((m,f,b)=>(m[f]=b,m),{});return c}var o=n(t);r=Array.isArray(r)?r:[r],e=Array.isArray(e)?e:[e];var i=r.length>1,s={remove:!1};return t.reduce((d,l,c)=>{if(s.remove=!1,!c)l.push(...r),d.push(l);else{var m=e.map(b=>l[o[b]]),f=a.apply(s,m);f=i?f:[f],s.remove,s.remove||(l.push(...f),d.push(l))}return d},[])},arrayIndex(t){var e=t[0],r=e.reduce((a,n,o)=>(a[n]=o,a),{});return r}}};window.web=w;const g={logout(){fetch("/public/logout",{method:"GET",credentials:"include"})},async hdsRequest(t,e,r={}){var a=await fetch(t,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return a},async hdsData(t,e={}){var r=`/secure/data/${user_info.USER_TYPE}/${t}`;try{var a=await this.hdsRequest(r,"POST",e);if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);return await a.json()}catch(n){console.error("Error fetching data:",n)}},db_enums:{CHARGE_STATUS:["Pending","Partially Paid","Paid","Cancelled"],COURSE_CATEGORY:["Adults","Teens","Seniors","Disabilities","Other"],COURSE_TYPE:["Class","Driving","Evaluation"],DELIVERY_METHOD:["Heights Classroom","High School Classroom","Online","Virtual","Behind the Wheel","Other"],LOCATION_TYPE:["On Site","Web Browser","Student Designated"],PAYMENT_METHOD:["Credit Card","Check","Cash","Other"],USER_TYPE:["ADMIN","INSTRUCTOR","STUDENT","OFFICE"],GENDER:["F","M","OTHER"]}};window.server=g;const v={icons:{edit_pencil:'<span class="material-icons">edit</span>',drill_down:'<button><span class="material-icons">subdirectory_arrow_right</span></button>',add_box:'<span class="material-icons plus-add">add</span>'},column_defs:{".*":{vertAlign:"middle"},_ID$:{visible:!1},".*DATE.*":{formatter:"datetime",formatterParams:{inputFormat:"iso",outputFormat:"yyyy-MM-dd",timezone:"America/New_York"}},CREATION_DATE:{formatter:"datetime",formatterParams:{inputFormat:"iso",outputFormat:"yyyy-MM-dd 'at' h:mm a",timezone:"America/New_York"}},IS_ACTIVE:{virtual_editor:!0,cellClick:(t,e)=>{e._cell.modules={edit:{edited:!0}},e.setValue(Number(e.getValue())===0?1:0),e.setEdited()},mutator:t=>t??0,headerHozAlign:"center",hozAlign:"center",title:"Active",field:"IS_ACTIVE",minWidth:70,maxWidth:80,cssClass:"tabulator-icon-column",formatter:"lookup",formatterParams:{0:'<span class="material-icons-outlined">check_box_outline_blank</span>',1:'<span  style =""class="material-icons-outlined">check_box</span>'}},BUTTON__:{minWidth:10,maxWidth:80,headerHozAlign:"center",cssClass:"tabulator-icon-column"},BUTTON__EDIT:{formatter:()=>v.icons.edit_pencil},BUTTON__DRILL_MASTER_DETAIL:{frozen:!0,headerSort:!1,formatter:()=>v.icons.drill_down},BUTTON__ADD_TO:{hozAlign:"center",frozen:!0,headerSort:!1,formatter:()=>v.icons.add_box},CHARGE_STATUS(){return h.createDropdown(g.db_enums.CHARGE_STATUS)},COURSE_CATEGORY(){return h.createDropdown(g.db_enums.COURSE_CATEGORY)},COURSE_TYPE(){return h.createDropdown(g.db_enums.COURSE_TYPE)},DELIVERY_METHOD(){return h.createDropdown(g.db_enums.DELIVERY_METHOD)},LOCATION_TYPE(){return h.createDropdown(g.db_enums.LOCATION_TYPE)},PAYMENT_METHOD(){return h.createDropdown(g.db_enums.PAYMENT_METHOD)},PAYMENT_STATUS(){return h.createDropdown(g.db_enums.PAYMENT_STATUS)},USER_TYPE(){return h.createDropdown(g.db_enums.USER_TYPE)},GENDER(){return h.createDropdown(g.db_enums.GENDER)}}},h={createDropdown(t){return{formatter:e=>`<div style="width:100%;display:flex; justify-content:space-between;"> ${e.getValue()??""}  <span style ="margin-right:3%;"class="material-icons-outlined">expand_more</span></div>`,mutator:e=>e??"",editor:"list",editorParams:{values:t,itemFormatter:function(e,r,a,n){return"<strong>"+e+" </strong><br/><div></div>"}}}}};class O{constructor(e={}){this.defaultOptions={placeholder:"No Data Available",addRowPos:"top",layout:"fitColumns",...e},this._tables=new Map,this.increment=0}predefinedColumnDefinitions(e,r){var a=Object.keys(e).reduce((n,o)=>{var i=new RegExp(o);if(i.test(r)){var s=typeof e[o]=="function"?e[o]():e[o];n={...n,...s}}return n},{});return a}createTable(e,r,a,{includeRowSelector:n=!1,forceTemplate:o=[],tableOptions:i={},columnOptions:s={},additionalColumns:d=[],onSaveServerFunction:l=function(){},rowProccesorFunction:c=!1}={}){const[m,...f]=a,b=m.map(u=>({...{title:O.formatString(u),field:u,visible:u!==r,resizable:!1},...this.predefinedColumnDefinitions(v.column_defs,u)||{},...s[u]||{}})),C=f.map(u=>u.reduce((p,E,_)=>(p[m[_]]=E,p),{}));c&&c(C);var S=n?{rowHeader:{width:"1.5em",formatter:()=>'<span class="material-icons-outlined">check_box_outline_blank</span>',cellClick:(u,p)=>{var E=p.getElement().innerHTML,_=p.getRow(),y=p.getTable();E==='<span class="material-icons-outlined">check_box_outline_blank</span>'&&(p.getElement().innerHTML='<span class="material-icons-outlined">check_box</span>',y.deselectRow(),_.select()),E==='<span class="material-icons-outlined">check_box</span>'&&(p.getElement().innerHTML='<span class="material-icons-outlined">check_box</span>',y.deselectRow())}}}:{};d.length&&(d=d.map(u=>u.field?{...u,...this.predefinedColumnDefinitions(v.column_defs,u.field)}:u));var A=[...d,...b];o.length&&(A=A.reduce((u,p)=>(!p.field||(p.column_order=o.indexOf(p.field),p.column_order===-1)||u.push(p),u),[]),A.sort((u,p)=>u.column_order-p.column_order));//! Merge default options with custom options for this specific table
const D={selectableRows:n?1:!1,...S,columns:A,data:C,...this.defaultOptions,...i,index:r};//! Create and return a new Tabulator instance
const T=new Tabulator(`#${e}`,D);//! If table is empty on creation
T.on("tableBuilt",function(){this.getData().length===0&&this.addRow()});//! Developer mode stuff
T.on("headerDblClick",function(u,p){w.copyToClipBoard(`[${p.getTable().getColumnLayout().map(E=>`['${E.field}']`).join(`,
`)}]`)}),T.on("cellEdited",function(u){}),this._tables.set(e,T);//!Adds the event listeners to the buttons
//!--------------------------------------------------------------------------//!--------------------------------------------------------------------------
[...w.$(e).parentElement.querySelectorAll("sl-button[data-click_function]")].map(u=>{var p=u.closest("div[data-table_context]").getAttribute("data-table_context"),E=R.getTable(p),_=u.getAttribute("data-click_function");u.getAttribute("data-click_function_param");const y={addRow:()=>{E.addRow({[r]:this.generateRowId()})},saveTable:async function(){await l(e),T.alert("Saved","msg"),setTimeout(x=>{T.clearAlert()},1e3)}};u.addEventListener("click",y[_])});//!--------------------------------------------------------------------//
return T.index=r,T}getTable(e){return this._tables.get(e)}getAllTables(){return Array.from(this._tables.values())}getTableDataAsArray(e){var r=this._tables.get(e),a=r.getColumns().reduce((n,o)=>(o.getField()&&n.push(o.getField()),n),[]);r.getData().reduce((n,o)=>{var i=a.map(s=>o[s]);return n.push(i),n},[])}getTableEditsForDb2(e,r){var a=this._tables.get(e),n=a.index,o;r?o=a.getColumns().reduce((l,c)=>{var m=c.getField();return r.indexOf(m)!==-1&&l.push(m),l},[]):o=a.getColumns().reduce((l,c)=>(c.getField()&&(c.getDefinition().editor||c.getDefinition().virtual_editor||c.getField()===n)&&l.push(c.getField()),l),[]);const s=this.getEditedRows(e).map(l=>l.getData("data"));console.log("edited data",s);var d=s.reduce((l,c)=>{var m=o.map(f=>c[f]);return l.push(m),l},[]);return d.unshift(o),d}getTableEdits(e){var r=this._tables.get(e);return r.getEditedCells().reduce((a,n)=>{var o=n.getRow().getIndex()??this.generateRowId(),i=n.getColumn().getField(),s=n.getValue();return a[o]?a[o][i]=s:a[o]={[i]:s},a},{})}getEditedRows(e){var r=this._tables.get(e),a=new Set(r.getEditedCells().reduce((n,o)=>{var i=o.getRow().getIndex();return n.push(i),n},[]));return r.getRows().filter(n=>a.has(n.getIndex()))}generateRowId(){return this.increment+=1,`temp_id_${this.increment}`}redrawAll(){Array.from(this._tables.values()).map(e=>e.redraw())}static formatString(e){return e.toLowerCase().split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}}const R=new O;export{v as a,h as c,g as s,R as t,w};
